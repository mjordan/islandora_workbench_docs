
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Islandora Workbench">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Development guide - Islandora Workbench</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#general" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Islandora Workbench" class="md-header__button md-logo" aria-label="Islandora Workbench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Islandora Workbench
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Development guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mjordan/islandora_workbench_docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Islandora Workbench" class="md-nav__button md-logo" aria-label="Islandora Workbench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Islandora Workbench
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mjordan/islandora_workbench_docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../drupal_and_workbench/" class="md-nav__link">
        Workbench's relationship to Drupal and Islandora
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Requirements and installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../choosing_a_task/" class="md-nav__link">
        Choosing a task
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configuration_settings_on_the_command_line/" class="md-nav__link">
        Specifying configuration settings on the command line
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../check/" class="md-nav__link">
        Checking configuration and input data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../preparing_data/" class="md-nav__link">
        Preparing your data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fields/" class="md-nav__link">
        Field data (Drupal and CSV)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ignoring_csv_rows_and_columns/" class="md-nav__link">
        Ignoring CSV rows and columns
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../checking_if_nodes_exist/" class="md-nav__link">
        Checking if nodes already exist
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../field_templates/" class="md-nav__link">
        CSV field templates
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../csv_value_templates/" class="md-nav__link">
        CSV value templates
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../paged_and_compound/" class="md-nav__link">
        Creating paged, compound, and collection content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nodes_only/" class="md-nav__link">
        Creating nodes without media
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../creating_nodes_from_files/" class="md-nav__link">
        Creating nodes from files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../recovery_mode/" class="md-nav__link">
        Recovering from interrupted create tasks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../updating_nodes/" class="md-nav__link">
        Updating nodes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deleting_nodes/" class="md-nav__link">
        Deleting nodes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../creating_taxonomy_terms/" class="md-nav__link">
        Creating taxonomy terms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../updating_terms/" class="md-nav__link">
        Updating taxonomy terms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../aliases/" class="md-nav__link">
        Assigning URL aliases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../redirects/" class="md-nav__link">
        Creating redirects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../alt_text/" class="md-nav__link">
        Adding alt text to images
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rolling_back/" class="md-nav__link">
        Rolling back nodes and media
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../media_types/" class="md-nav__link">
        Configuring media types
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quick_delete/" class="md-nav__link">
        Quick delete
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../adding_media/" class="md-nav__link">
        Adding media to nodes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../adding_multiple_media/" class="md-nav__link">
        Adding multiple media
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../media_track_files/" class="md-nav__link">
        Creating media track files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../updating_media/" class="md-nav__link">
        Updating media
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deleting_media/" class="md-nav__link">
        Deleting media
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../generating_csv_files/" class="md-nav__link">
        Generating CSV files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../exporting_islandora_7_content/" class="md-nav__link">
        Exporting Islandora 7 content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fixity/" class="md-nav__link">
        Fixity checking
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../csv_id_to_node_id_map/" class="md-nav__link">
        The CSV ID to node ID map
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cancelling/" class="md-nav__link">
        Cancelling Workbench
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contact_sheet/" class="md-nav__link">
        Generating a contact sheet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reducing_load/" class="md-nav__link">
        Reducing Workbench's impact on Drupal
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sample_data/" class="md-nav__link">
        Creating nodes from the sample data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../prompts/" class="md-nav__link">
        Prompting the user
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../generating_sample_content/" class="md-nav__link">
        Generating sample Islandora content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../limitations/" class="md-nav__link">
        Known limitations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Development guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Development guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    Running tests
  </a>
  
    <nav class="md-nav" aria-label="Running tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests-that-do-not-require-a-live-islandora-instance" class="md-nav__link">
    Unit tests that do not require a live Islandora instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests-that-require-a-live-islandora-instance" class="md-nav__link">
    Integration tests that require a live Islandora instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    Writing tests
  </a>
  
    <nav class="md-nav" aria-label="Writing tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-simple-unit-test" class="md-nav__link">
    A simple unit test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-simple-integration-test" class="md-nav__link">
    A simple integration test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-more-complex-integration-test" class="md-nav__link">
    A more complex integration test
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-drupal-field-type" class="md-nav__link">
    Adding a new Drupal field type
  </a>
  
    <nav class="md-nav" aria-label="Adding a new Drupal field type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-of-how-workbench-handles-field-types" class="md-nav__link">
    Overview of how Workbench handles field types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-class-methods" class="md-nav__link">
    Field class methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#islandora-workbench-integration-drupal-module" class="md-nav__link">
    Islandora Workbench Integration Drupal module
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Change log
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    Running tests
  </a>
  
    <nav class="md-nav" aria-label="Running tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests-that-do-not-require-a-live-islandora-instance" class="md-nav__link">
    Unit tests that do not require a live Islandora instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests-that-require-a-live-islandora-instance" class="md-nav__link">
    Integration tests that require a live Islandora instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    Writing tests
  </a>
  
    <nav class="md-nav" aria-label="Writing tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-simple-unit-test" class="md-nav__link">
    A simple unit test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-simple-integration-test" class="md-nav__link">
    A simple integration test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-more-complex-integration-test" class="md-nav__link">
    A more complex integration test
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-drupal-field-type" class="md-nav__link">
    Adding a new Drupal field type
  </a>
  
    <nav class="md-nav" aria-label="Adding a new Drupal field type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-of-how-workbench-handles-field-types" class="md-nav__link">
    Overview of how Workbench handles field types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-class-methods" class="md-nav__link">
    Field class methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#islandora-workbench-integration-drupal-module" class="md-nav__link">
    Islandora Workbench Integration Drupal module
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/mjordan/islandora_workbench_docs/edit/main/docs/development_guide.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Development guide</h1>

<p>This documentation is aimed at developers who want to contribute to Islandora Workbench.</p>
<h2 id="general">General</h2>
<ul>
<li>Bug reports, improvements, feature requests, and PRs are welcome. Before you open a pull request, <em>please open an issue so we can discuss your idea</em>. In cases where the PR introduces a potentially disruptive change to Workbench, we usually want to start a discussion about its impact on users in the <code>#islandoraworkbench</code> Slack channel.<ul>
<li>When you open a PR, you will be asked to complete the Workbench <a href="https://github.com/mjordan/islandora_workbench/blob/main/.github/PULL_REQUEST_TEMPLATE.md">PR template</a>.</li>
</ul>
</li>
<li>All code must be formatted using <a href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html">Black</a>. You can automatically style your code <a href="https://black.readthedocs.io/en/stable/integrations/editors.html">using Black in your IDE of choice</a> or from your command line. Lint checks using Black are performed during Github CI so unlinted code will cause pull request merges to fail.</li>
<li>Where applicable, unit and integration tests to accompany your code are very appreciated. Tests in Workbench fall into two categories:<ul>
<li><em>Unit tests</em> that do not require a live Islandora instance.</li>
<li><em>Integration tests</em> that require a live Islandora instance running at <code>https://islandora.dev</code> (or some other local URL).</li>
</ul>
</li>
<li><code>workbench_utils.py</code> provides a lot of utility functions or functions used across the application. Before writing a new utility function, please ensure that something similar to what you want to write doesn't already exist.</li>
</ul>
<h2 id="running-tests">Running tests</h2>
<p>While developing code for Islandora Workbench, you should run tests frequently to ensure that your code hasn't introduced any regression errors. Workbench is a fairly large and complex application, and has many configuration settings. Even minor changes in the code can break things.</p>
<h3 id="unit-tests-that-do-not-require-a-live-islandora-instance">Unit tests that do not require a live Islandora instance</h3>
<p>There are several test class files containing tests that do not require a live Islandora instance to run:</p>
<ul>
<li>Unit tests in <code>tests/unit_tests.py</code> (run with <code>python tests/unit_tests.py</code>)</li>
<li>Unit tests for Workbench's Drupal fields handlers in <code>tests/field_tests.py</code> (run with <code>python tests/field_tests.py</code>)</li>
</ul>
<p>These tests are run automatically as GitHub actions when you push to the Islandora Workbench repo or when a merge request is merged.</p>
<h3 id="integration-tests-that-require-a-live-islandora-instance">Integration tests that require a live Islandora instance</h3>
<p>Integration tests are configured to interact with an Islandora instance running at <code>https://islandora.dev</code> with the username <code>admin</code> and password <code>password</code>. If those configuration settings match your local Islandora configuration (e.g. running in Docker), you can run these tests without building a set of local test files. If your local setup requires different settings, you can run the tests after building a set of local tests (explained below).</p>
<p>Assuming you have an Islandora instance running at <code>https://islandora.dev</code>, <code>tests/islandora_tests.py</code>, <code>tests/islandora_tests_check.py</code>,  <code>tests/islandora_tests_hooks.py</code>, and <code>tests/islandora_tests_paged_content.py</code> can be run with <code>python tests/islandora_tests.py</code>, etc.</p>
<p>If your local setup requires different <code>host</code>, <code>username</code> or <code>password</code> configuration settings, you will need to first build a copy of the test code and data files that uses your settings. To do so, from within the Islandora Workbench directory (by default <code>islandora_workbench</code>), run <code>python scripts/make_local_tests.py</code>. This script will create a copy of Workbench's <code>tests</code> directory at <code>tests_local</code> and modify the <code>host</code>, <code>username</code>, and <code>password</code> configuration settings to <code>https://islandora.traefik.me</code>, <code>admin</code>, and <code>password</code> respectively. If you want to use other values for those settings, pass them into the script using the following command-line arguments (which are all optional but are shown here for reference):</p>
<p><code>python scripts/make_local_tests.py --host http://mylocalislandora.dev --username mark --password foo</code></p>
<p>Then, to run the tests, simply change the test directory path from <code>tests</code> to <code>tests_local</code>, e.g. <code>python tests_local/islandora_tests.py</code></p>
<p>A few notes about running integration tests:</p>
<ul>
<li>The Islandora Starter Site deployed with <a href="https://github.com/Islandora-Devops/isle-dc">ISLE</a> is recommended way to deploy the Islandora used in these tests. Integration tests remove all nodes and media added during the tests, unless a test fails. Taxonomy terms created by tests are not removed.</li>
<li>Some integration and field tests output text that beings with "Error:." This is normal, it's the text that Workbench outputs when it finds something wrong (which is probably what the test is testing). Successful test (whether they test for success or failure) runs will exit with "OK". If you can figure out how to suppress this output, please visit <a href="https://github.com/mjordan/islandora_workbench/issues/160">this issue</a>.</li>
<li>If you want to run the tests within a specific class, include the class name as an argument like this: <code>python tests_local/unit_tests.py TestCompareStings</code></li>
<li>You can also specify multiple test classes within a single test file: <code>python tests_local/islandora_tests.py TestMyNewTest TestMyOtherNewTest</code></li>
<li>Running <code>scripts/make_local_tests.py</code> overwrites the entire <code>tests_local</code> directory before generating a new set of test code and data.</li>
</ul>
<h2 id="writing-tests">Writing tests</h2>
<p>Islandora Workbench's tests are written using the Python built-in <a href="https://docs.python.org/3/library/unittest.html">unittest</a> library, and as explained above, fall into two categories:</p>
<ul>
<li>Unit tests that do not require a live Islandora instance.</li>
<li>Integration tests that require a live Islandora instance running at <code>https://islandora.traefik.me/</code>.</li>
</ul>
<p><code>unittest</code> groups tests into classes. A single test file can contain one or more test classes. Within each test class, you can put one or more test methods. As shown in the second example below, two reserved methods, <code>setUp()</code> and <code>tearDown()</code>, are reserved for setup and cleanup tasks, respectively, within each class. If you are new to using <code>unittest</code>, <a href="https://www.pythontutorial.net/python-unit-testing/">this</a> is a good tutorial.</p>
<p>Always add new tests to Workbench's <code>tests</code> directory, not <code>tests_local</code>. <code>tests</code> is used by Github's CI runners, so new tests must be present in that directory during merge requests. Since running <code>scripts/make_local_tests.py</code> copies everthing in <code>tests</code> to <code>tests_local</code>, any changes you make (or additions) to files in <code>tests</code> will be copied over to <code>tests_local</code> intact.</p>
<h3 id="a-simple-unit-test">A simple unit test</h3>
<p>Islandora Workbench unit tests are much like unit tests in any Python application. The sample test below, from <code>tests/unit_tests.py</code>, tests the <code>validate_latlong_value()</code> method from the <code>workbench_utils.py</code> module. Since <code>workbench_utils.validate_latlong_value()</code> doesn't interact with Islandora, <code>https://islandora.traefik.me/</code> doesn't need to be available to run this unit test.</p>
<pre><code class="language-python">class TestValidateLatlongValue(unittest.TestCase):

    def test_validate_good_latlong_values(self):
        values = ['+90.0, -127.554334', '90.0, -127.554334', '-90,-180', '+50.25,-117.8', '+48.43333,-123.36667']
        for value in values:
            res = workbench_utils.validate_latlong_value(value)
            self.assertTrue(res)

    def test_validate_bad_latlong_values(self):
        values = ['+90.1 -100.111', '045, 180', '+5025,-117.8', '-123.36667']
        for value in values:
            res = workbench_utils.validate_latlong_value(value)
            self.assertFalse(res)
</code></pre>
<p>This is a fairly standard Python unit test - we define a list of valid lat/long pairs and run them through the <code>workbench_utils.validate_latlong_value()</code> method expecting it to return <code>True</code> for each value, and then we define a list of bad lat/long pairs and run them through the method expecting it to return <code>False</code> for each value.</p>
<h3 id="a-simple-integration-test">A simple integration test</h3>
<p>The two sample integration tests provided below are copied from <code>islandora_tests.py</code>.</p>
<p>The first sample integration test, <code>TestCreate</code>, looks like this (with line numbers added for easy reference). Configuration and CSV files used by this test are in <code>tests/assets/create_test</code>:</p>
<pre><code class="language-python">1. class TestCreate(unittest.TestCase):
2.
3.     def setUp(self):
4.         self.current_dir = os.path.dirname(os.path.abspath(__file__))
5.         self.create_config_file_path = os.path.join(self.current_dir, 'assets', 'create_test', 'create.yml')
6.         self.create_cmd = [&quot;./workbench&quot;, &quot;--config&quot;, self.create_config_file_path]
7.
8.     def test_create(self):
9.         self.nids = list()
10.         create_output = subprocess.check_output(self.create_cmd)
11.         create_output = create_output.decode().strip()
12.         create_lines = create_output.splitlines()
13.         for line in create_lines:
14.             if 'created at' in line:
15.                 nid = line.rsplit('/', 1)[-1]
16.                 nid = nid.strip('.')
17.                 self.nids.append(nid)
18.
19.         self.assertEqual(len(self.nids), 2)
20.
21.     def tearDown(self):
22.         for nid in self.nids:
23.             quick_delete_cmd = [&quot;./workbench&quot;, &quot;--config&quot;, self.create_config_file_path, '--quick_delete_node', 'https://islandora.traefik.me/node/' + nid]
24.             quick_delete_output = subprocess.check_output(quick_delete_cmd)
25.
26.         self.rollback_file_path = os.path.join(self.current_dir, 'assets', 'create_test', 'rollback.csv')
27.         if os.path.exists(self.rollback_file_path):
28.             os.remove(self.rollback_file_path)
29.
30.         self.preprocessed_file_path = os.path.join(self.current_dir, 'assets', 'create_test', 'metadata.csv.preprocessed')
31.         if os.path.exists(self.preprocessed_file_path):
32.             os.remove(self.preprocessed_file_path)

</code></pre>
<p>As you can see, this test runs Workbench using the config file <code>create.yml</code> (line 10), which lives at <code>tests/assets/create_test/create.yml</code>, relative to the workbench directory. A tricky aspect of using real config files in tests is that all paths mentioned in the config file must be relative to the workbench directory. This <code>create.yml</code> defines the <code>input_dir</code> setting to be <code>tests/assets/create_test</code>:</p>
<pre><code class="language-yaml">task: create
host: https://islandora.traefik.me
username: admin
password: password
input_dir: &quot;tests/assets/create_test&quot;
media_type: image
allow_missing_files: True
</code></pre>
<p>The test's <code>setUp()</code> method prepares the file paths, etc. and within the test's only test method, <code>test_create()</code>, runs Workbench using Python's <code>subprocess.check_output()</code> method, grabs the node IDs from the output from the "created at" strings emitted by Workbench (lines 14-17), adds them to a list, and then counts the number of members in that list. If the number of nodes created matches the expected number, the test passes.</p>
<p>Since this test creates some nodes, we use the test class's <code>tearDown()</code> method to put the target Drupal back into as close a state as we started with as possible. <code>tearDown()</code> basically takes the list of node IDs created in <code>test_create()</code> and runs Workbench with the <code>--quick_delete_node</code> option. It then removes any temporary files created during the test.</p>
<h3 id="a-more-complex-integration-test">A more complex integration test</h3>
<p>Since Workbench is essentially a specialized REST client, writing integration tests that require interaction with Drupal can get a bit complex. But, the overall pattern is:</p>
<ol>
<li>Create some entities (nodes, media, taxonomy terms).</li>
<li>Confirm that they were created in the expected way (doing this usually involves keeping track of any node IDs needed to run tests or to clean up, and in some cases involves parsing out values from raw JSON returned by Drupal).</li>
<li>Clean up by deleting any Drupal entities created during the tests and also any temporary local files.</li>
</ol>
<p>An integration test that checks data in the node JSON is <code>TestUpdateWithMaxNodeTitleLength()</code>. Files that accompany this test are in <code>tests/assets/max_node_title_length_test</code>. Here is a copy of the test's code:</p>
<pre><code class="language-python">1. class TestUpdateWithMaxNodeTitleLength(unittest.TestCase):
2.
3.     def setUp(self):
4.         self.current_dir = os.path.dirname(os.path.abspath(__file__))
5.         self.create_config_file_path = os.path.join(self.current_dir, 'assets', 'max_node_title_length_test', 'create.yml')
6.         self.create_cmd = [&quot;./workbench&quot;, &quot;--config&quot;, self.create_config_file_path]
7.         self.nids = list()
8.
9.         self.update_csv_file_path = os.path.join(self.current_dir, 'assets', 'max_node_title_length_test', 'update_max_node_title_length.csv')
10.         self.update_config_file_path = os.path.join(self.current_dir, 'assets', 'max_node_title_length_test', 'update.yml')
11.         self.update_cmd = [&quot;./workbench&quot;, &quot;--config&quot;, self.update_config_file_path]
12.
13.         self.temp_dir = tempfile.gettempdir()
14.
15.     def test_create(self):
16.         create_output = subprocess.check_output(self.create_cmd)
17.         self.create_output = create_output.decode().strip()
18.
19.         create_lines = self.create_output.splitlines()
20.         for line in create_lines:
21.             if 'created at' in line:
22.                 nid = line.rsplit('/', 1)[-1]
23.                 nid = nid.strip('.')
24.                 self.nids.append(nid)
25.
26.         self.assertEqual(len(self.nids), 6)
27.
28.         # Write out an update CSV file using the node IDs in self.nids.
29.         update_csv_file_rows = list()
30.         test_titles = ['This title is 37 chars___________long',
31.                        'This title is 39 chars_____________long',
32.                        'This title is 29 _ chars long',
33.                        'This title is 42 chars________________long',
34.                        'This title is 44 chars__________________long',
35.                        'This title is 28 chars long.']
36.         update_csv_file_rows.append('node_id,title')
37.         i = 0
38.         while i &lt;= 5:
39.             update_csv_file_rows.append(f'{self.nids[i]},{test_titles[i]}')
40.             i = i + 1
41.         with open(self.update_csv_file_path, mode='wt') as update_csv_file:
42.             update_csv_file.write('\n'.join(update_csv_file_rows))
43.
44.         # Run the update command.
45.         check_output = subprocess.check_output(self.update_cmd)
46.
47.         # Fetch each node in self.nids and check to see if its title is &lt;= 30 chars long. All should be.
48.         for nid_to_update in self.nids:
49.             node_url = 'https://islandora.traefik.me/node/' + str(self.nids[0]) + '?_format=json'
50.             node_response = requests.get(node_url)
51.             node = json.loads(node_response.text)
52.             updated_title = str(node['title'][0]['value'])
53.             self.assertLessEqual(len(updated_title), 30, '')
54.
55.     def tearDown(self):
56.         for nid in self.nids:
57.             quick_delete_cmd = [&quot;./workbench&quot;, &quot;--config&quot;, self.create_config_file_path, '--quick_delete_node', 'https://islandora.traefik.me/node/' + nid]
58.             quick_delete_output = subprocess.check_output(quick_delete_cmd)
59.
60.         self.rollback_file_path = os.path.join(self.current_dir, 'assets', 'max_node_title_length_test', 'rollback.csv')
61.         if os.path.exists(self.rollback_file_path):
62.             os.remove(self.rollback_file_path)
63.
64.         self.preprocessed_file_path = os.path.join(self.temp_dir, 'create_max_node_title_length.csv.preprocessed')
65.         if os.path.exists(self.preprocessed_file_path):
66.             os.remove(self.preprocessed_file_path)
67.
68.         # Update test: 1) delete the update CSV file, 2) delete the update .preprocessed file.
69.         if os.path.exists(self.update_csv_file_path):
70.             os.remove(self.update_csv_file_path)
71.
72.         self.preprocessed_update_file_path = os.path.join(self.temp_dir, 'update_max_node_title_length.csv.preprocessed')
73.         if os.path.exists(self.preprocessed_update_file_path):
74.             os.remove(self.preprocessed_update_file_path)
</code></pre>
<p>This test:</p>
<ol>
<li>(line 16) creates some nodes that will be updated within the same test class (i.e. in line 45)</li>
<li>(lines 28-42) writes out a temporary CSV file which will be used as the <code>input_csv</code> file in a subsequent <code>update</code> task containing the new node IDs plus some titles that are longer than <code>max_node_title_length: 30</code> setting in the <code>assets/max_node_title_length_test/update.yml</code> file</li>
<li>(line 45) runs <code>self.update_cmd</code> to execute the <code>update</code> task</li>
<li>(lines 47-53) fetches the title values for each of the updated nodes and tests the length of each title string to confirm that it does not exceed the maximum allowed length of 30 characters.</li>
</ol>
<p><code>tearDown()</code> removes all nodes created by the test and removes all temporary local files.</p>
<h2 id="adding-a-new-drupal-field-type">Adding a new Drupal field type</h2>
<h4 id="overview-of-how-workbench-handles-field-types">Overview of how Workbench handles field types</h4>
<p>Workbench and Drupal exchange field data represented as JSON, via Drupal's REST API. The specific JSON structure depends on the field type (text, entity reference, geolocation, etc.). Handling the details of these structures when adding new field data during <code>create</code> tasks, updating existing field data during <code>update</code> tasks, etc. is performed by code in the <code>workbench_fields.py</code> module.</p>
<p>Each distinct field structure has its own class in that file, and each of the classes has the methods <code>create()</code>, <code>update()</code>, <code>dedupe_values()</code>, <code>remove_invalid_values()</code>, and <code>serialize()</code>. The <code>create()</code> and <code>update()</code> methods convert CSV field data in Workbench input files to Python dictionaries, which are subsequently converted into JSON for pushing up to Drupal. The <code>serialize()</code> method reverses this conversion, taking the JSON field data fetched from Drupal and converting it into a dictionary, and from that, into CSV data. <code>dedupe_values()</code> and <code>remove_invalid_values()</code> are utility methods that do what their names suggest.</p>
<p>Currently, Workbench supports the following field types:</p>
<ul>
<li>"simple" fields for<ul>
<li>strings (for string or text fields)</li>
<li>integers</li>
<li>binary values 1 and 0</li>
<li>existing Drupal-generated entity IDs</li>
</ul>
</li>
<li>entity reference fields</li>
<li>entity reference revision fields</li>
<li>typed relation fields</li>
<li>link fields</li>
<li>geolocation fields</li>
<li>authority link fields</li>
<li>media track fields</li>
</ul>
<p>Eventually, classes for new Drupal field types will need to be added to Workbench as the community adopts more field types provided by Drupal contrib modules or creates new field types specific to Islandora.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If new field types are added to workbench_utils.py, corresponding logic must be added to functions in other Workbench modules (e.g. workbench_utils, workbench) that create, update, or export Drupal entities. Those places are commented in the code with either:</p>
<p>"Assemble Drupal field structures from CSV data. If new field types are added to
workbench_fields.py, they need to be registered in the following if/elif/else block."</p>
<p>or</p>
<p>"Assemble CSV output Drupal field data. If new field types are added to
workbench_fields.py, they need to be registered in the following if/elif/else block."</p>
</div>
<h4 id="field-class-methods">Field class methods</h4>
<p>The most complex aspect of handling field data is cardinality, or in other words, whether a given field's configuration setting "Allowed number of values" allows for a single value, a maximum number of values (for example, a maximum of 3 values), or an unlimited number of values.</p>
<p><img alt="Maximum field values example" src="../images/max_field_values.png" /></p>
<p>Each field type's cardinality configuration complicates creating and updating field instances because Workbench must deal with situations where input CSV data for a field contains more values than are allowed, or when the user wants to append a value to an existing field instance rather than replace existing values, potentially exceeding the field's configured cardinality. Drupal's REST interface is very strict about cardinality, and if Workbench tries to push up a field's JSON that violates the field's cardinality, the HTTP request fails and returns a <code>422 Unprocessable Content</code> response for the node containing the malformed field data.</p>
<p>To prevent this from happening, code within field type classes needs to contain logic to account for the three different types of cardinality (cardinality of 1, cardinality of more than 1 but with a maximum, and unlimited) and for the specific JSON structure created from the field data in the input CSV. When Workbench detects that the number of field instances in the CSV data surpasses the field's maximum configured cardinality, it will truncate the incoming data and log that it did so via the <code>log_field_cardinality_violation()</code> utility function. However, truncating data is a fallback behavior; <code>--check</code> will report intances of this cardinality violation, providing you with an opportunity to correct the CSV data before committing it to Drupal.</p>
<p>To illustrate this complexity, let's look at the <code>update()</code> method within the <code>SimpleField</code> class, which handles field types that have the Python structure <code>[{"value": value}]</code> or, for "formatted" text, <code>[{"value": value, "format": text_format}]</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the example structure in the preceding paragraph shows a single value for that field. It's a list, but a list containing a single dictionary. If there were two values in a field, the structure would be a list containing two dictionaries, like <code>[{"value": value}, {"value": value}]</code>. If the field contained three values, the structure would be <code>[{"value": value}, {"value": value}, {"value": value}]</code></p>
</div>
<p>Lines 47-167 in the sample <code>update()</code> method apply when the field is configured to have a limited cardinality, either 1 or a specific number higher than 1. Within that range of lines, 49-113 apply if the <code>update_mode</code> configuration setting is "append", and lines 115-167 apply if the <code>update_mode</code> setting is "replace". Lines 169-255 apply when the field's cardinality is unlimited. Within that range of lines, 171-214 apply if the <code>update_mode</code> is "append", and lines 215-255 apply if it is "replace". An <code>update_mode</code> setting of "delete" simply removes all values from the field, in lines 28-30.</p>
<pre><code class="language-python">1.     def update(
2.         self, config, field_definitions, entity, row, field_name, entity_field_values
3.     ):
4.     &quot;&quot;&quot;Note: this method appends incoming CSV values to existing values, replaces existing field
5.     values with incoming values, or deletes all values from fields, depending on whether
6.     config['update_mode'] is 'append', 'replace', or 'delete'. It does not replace individual
7.     values within fields.
8.     &quot;&quot;&quot;
9.     &quot;&quot;&quot;Parameters
10.         ----------
11.         config : dict
12.             The configuration settings defined by workbench_config.get_config().
13.         field_definitions : dict
14.             The field definitions object defined by get_field_definitions().
15.         entity : dict
16.             The dict that will be POSTed to Drupal as JSON.
17.         row : OrderedDict.
18.             The current CSV record.
19.         field_name : string
20.             The Drupal fieldname/CSV column header.
21.         entity_field_values : list
22.             List of dictionaries containing existing value(s) for field_name in the entity being updated.
23.         Returns
24.         -------
25.         dictionary
26.             A dictionary representing the entity that is PATCHed to Drupal as JSON.
27.     &quot;&quot;&quot;
28.     if config[&quot;update_mode&quot;] == &quot;delete&quot;:
29.         entity[field_name] = []
30.         return entity
31.
32.     if row[field_name] is None:
33.         return entity
34.
35.     if field_name in config[&quot;field_text_format_ids&quot;]:
36.         text_format = config[&quot;field_text_format_ids&quot;][field_name]
37.     else:
38.         text_format = config[&quot;text_format_id&quot;]
39.
40.     if config[&quot;task&quot;] == &quot;update_terms&quot;:
41.         entity_id_field = &quot;term_id&quot;
42.     if config[&quot;task&quot;] == &quot;update&quot;:
43.         entity_id_field = &quot;node_id&quot;
44.     if config[&quot;task&quot;] == &quot;update_media&quot;:
45.         entity_id_field = &quot;media_id&quot;
46.
47.     # Cardinality has a limit.
48.     if field_definitions[field_name][&quot;cardinality&quot;] &gt; 0:
49.         if config[&quot;update_mode&quot;] == &quot;append&quot;:
50.             if config[&quot;subdelimiter&quot;] in row[field_name]:
51.                 subvalues = row[field_name].split(config[&quot;subdelimiter&quot;])
52.                 subvalues = self.remove_invalid_values(
53.                     config, field_definitions, field_name, subvalues
54.                 )
55.                 for subvalue in subvalues:
56.                     subvalue = truncate_csv_value(
57.                         field_name,
58.                         row[entity_id_field],
59.                         field_definitions[field_name],
60.                         subvalue,
61.                     )
62.                     if (
63.                         &quot;formatted_text&quot; in field_definitions[field_name]
64.                         and field_definitions[field_name][&quot;formatted_text&quot;] is True
65.                     ):
66.                         entity[field_name].append(
67.                             {&quot;value&quot;: subvalue, &quot;format&quot;: text_format}
68.                         )
69.                     else:
70.                         entity[field_name].append({&quot;value&quot;: subvalue})
71.                 entity[field_name] = self.dedupe_values(entity[field_name])
72.                 if len(entity[field_name]) &gt; int(
73.                     field_definitions[field_name][&quot;cardinality&quot;]
74.                 ):
75.                     log_field_cardinality_violation(
76.                         field_name,
77.                         row[entity_id_field],
78.                         field_definitions[field_name][&quot;cardinality&quot;],
79.                     )
80.                     entity[field_name] = entity[field_name][
81.                         : field_definitions[field_name][&quot;cardinality&quot;]
82.                     ]
83.             else:
84.                 row[field_name] = self.remove_invalid_values(
85.                     config, field_definitions, field_name, row[field_name]
86.                 )
87.                 row[field_name] = truncate_csv_value(
88.                     field_name,
89.                     row[entity_id_field],
90.                     field_definitions[field_name],
91.                     row[field_name],
92.                 )
93.                 if (
94.                     &quot;formatted_text&quot; in field_definitions[field_name]
95.                     and field_definitions[field_name][&quot;formatted_text&quot;] is True
96.                 ):
97.                     entity[field_name].append(
98.                         {&quot;value&quot;: row[field_name], &quot;format&quot;: text_format}
99.                     )
100.                 else:
101.                     entity[field_name].append({&quot;value&quot;: row[field_name]})
102.                 entity[field_name] = self.dedupe_values(entity[field_name])
103.                 if len(entity[field_name]) &gt; int(
104.                     field_definitions[field_name][&quot;cardinality&quot;]
105.                 ):
106.                     log_field_cardinality_violation(
107.                         field_name,
108.                         row[entity_id_field],
109.                         field_definitions[field_name][&quot;cardinality&quot;],
110.                     )
111.                     entity[field_name] = entity[field_name][
112.                         : field_definitions[field_name][&quot;cardinality&quot;]
113.                     ]
114.
115.         if config[&quot;update_mode&quot;] == &quot;replace&quot;:
116.             if config[&quot;subdelimiter&quot;] in row[field_name]:
117.                 field_values = []
118.                 subvalues = row[field_name].split(config[&quot;subdelimiter&quot;])
119.                 subvalues = self.remove_invalid_values(
120.                     config, field_definitions, field_name, subvalues
121.                 )
122.                 subvalues = self.dedupe_values(subvalues)
123.                 if len(subvalues) &gt; int(
124.                     field_definitions[field_name][&quot;cardinality&quot;]
125.                 ):
126.                     log_field_cardinality_violation(
127.                         field_name,
128.                         row[entity_id_field],
129.                         field_definitions[field_name][&quot;cardinality&quot;],
130.                     )
131.                     subvalues = subvalues[
132.                         : field_definitions[field_name][&quot;cardinality&quot;]
133.                     ]
134.                 for subvalue in subvalues:
135.                     subvalue = truncate_csv_value(
136.                         field_name,
137.                         row[entity_id_field],
138.                         field_definitions[field_name],
139.                         subvalue,
140.                     )
141.                     if (
142.                         &quot;formatted_text&quot; in field_definitions[field_name]
143.                         and field_definitions[field_name][&quot;formatted_text&quot;] is True
144.                     ):
145.                         field_values.append(
146.                             {&quot;value&quot;: subvalue, &quot;format&quot;: text_format}
147.                         )
148.                     else:
149.                         field_values.append({&quot;value&quot;: subvalue})
150.                 field_values = self.dedupe_values(field_values)
151.                 entity[field_name] = field_values
152.             else:
153.                 row[field_name] = truncate_csv_value(
154.                     field_name,
155.                     row[entity_id_field],
156.                     field_definitions[field_name],
157.                     row[field_name],
158.                 )
159.                 if (
160.                     &quot;formatted_text&quot; in field_definitions[field_name]
161.                     and field_definitions[field_name][&quot;formatted_text&quot;] is True
162.                 ):
163.                     entity[field_name] = [
164.                         {&quot;value&quot;: row[field_name], &quot;format&quot;: text_format}
165.                     ]
166.                 else:
167.                     entity[field_name] = [{&quot;value&quot;: row[field_name]}]
168.
169.     # Cardinality is unlimited.
170.     else:
171.         if config[&quot;update_mode&quot;] == &quot;append&quot;:
172.             if config[&quot;subdelimiter&quot;] in row[field_name]:
173.                 field_values = []
174.                 subvalues = row[field_name].split(config[&quot;subdelimiter&quot;])
175.                 subvalues = self.remove_invalid_values(
176.                     config, field_definitions, field_name, subvalues
177.                 )
178.                 for subvalue in subvalues:
179.                     subvalue = truncate_csv_value(
180.                         field_name,
181.                         row[entity_id_field],
182.                         field_definitions[field_name],
183.                         subvalue,
184.                     )
185.                     if (
186.                         &quot;formatted_text&quot; in field_definitions[field_name]
187.                         and field_definitions[field_name][&quot;formatted_text&quot;] is True
188.                     ):
189.                         field_values.append(
190.                             {&quot;value&quot;: subvalue, &quot;format&quot;: text_format}
191.                         )
192.                     else:
193.                         field_values.append({&quot;value&quot;: subvalue})
194.                 entity[field_name] = entity_field_values + field_values
195.                 entity[field_name] = self.dedupe_values(entity[field_name])
196.             else:
197.                 row[field_name] = truncate_csv_value(
198.                     field_name,
199.                     row[entity_id_field],
200.                     field_definitions[field_name],
201.                     row[field_name],
202.                 )
203.                 if (
204.                     &quot;formatted_text&quot; in field_definitions[field_name]
205.                     and field_definitions[field_name][&quot;formatted_text&quot;] is True
206.                 ):
207.                     entity[field_name] = entity_field_values + [
208.                         {&quot;value&quot;: row[field_name], &quot;format&quot;: text_format}
209.                     ]
210.                 else:
211.                     entity[field_name] = entity_field_values + [
212.                         {&quot;value&quot;: row[field_name]}
213.                     ]
214.                 entity[field_name] = self.dedupe_values(entity[field_name])
215.         if config[&quot;update_mode&quot;] == &quot;replace&quot;:
216.             if config[&quot;subdelimiter&quot;] in row[field_name]:
217.                 field_values = []
218.                 subvalues = row[field_name].split(config[&quot;subdelimiter&quot;])
219.                 subvalues = self.remove_invalid_values(
220.                     config, field_definitions, field_name, subvalues
221.                 )
222.                 for subvalue in subvalues:
223.                     subvalue = truncate_csv_value(
224.                         field_name,
225.                         row[entity_id_field],
226.                         field_definitions[field_name],
227.                         subvalue,
228.                     )
229.                     if (
230.                         &quot;formatted_text&quot; in field_definitions[field_name]
231.                         and field_definitions[field_name][&quot;formatted_text&quot;] is True
232.                     ):
233.                         field_values.append(
234.                             {&quot;value&quot;: subvalue, &quot;format&quot;: text_format}
235.                         )
236.                     else:
237.                         field_values.append({&quot;value&quot;: subvalue})
238.                 entity[field_name] = field_values
239.                 entity[field_name] = self.dedupe_values(entity[field_name])
240.             else:
241.                 row[field_name] = truncate_csv_value(
242.                     field_name,
243.                     row[entity_id_field],
244.                     field_definitions[field_name],
245.                     row[field_name],
246.                 )
247.                 if (
248.                     &quot;formatted_text&quot; in field_definitions[field_name]
249.                     and field_definitions[field_name][&quot;formatted_text&quot;] is True
250.                 ):
251.                     entity[field_name] = [
252.                         {&quot;value&quot;: row[field_name], &quot;format&quot;: text_format}
253.                     ]
254.                 else:
255.                     entity[field_name] = [{&quot;value&quot;: row[field_name]}]
256.
257.     return entity
</code></pre>
<p>Each field type has its own structure. Within the field classes, the field structure is represented in Python dictionaries and converted to JSON when pushed up to Drupal as part of REST requests. These Python dictionaries are converted to JSON automatically as part of the HTTP request to Drupal (you do not do this within the field classes) so we'll focus only on the Python dictionary structure here. Some examples are:</p>
<ul>
<li><code>SimpleField</code> fields have the Python structure <code>{"value": value}</code> or, for "formatted" text, <code>{"value": value, "format": text_format}</code></li>
<li><code>GeolocationField</code> fields have the Python structure <code>{"lat": lat_value, "lon": lon_value}</code></li>
<li><code>LinkField</code> fields have the python structure <code>{"uri": uri, "title": title}</code></li>
<li><code>EntityReferenceField</code> fields have the Python structure <code>{"target_id": id, "target_type": target_type}</code></li>
<li><code>TypedRelationField</code> fields have the Python structure <code>{"target_id": id, "rel_type": rel_type:rel_value, "target_type": target_type}</code><ul>
<li>the value of the <code>rel_type</code> key is the relator type (e.g. MARC relators) and the relator value (e.g. 'art') joined with a colon, e.g. <code>relators:art</code></li>
</ul>
</li>
<li><code>AuthorityLinkField</code> fields have the Python structure <code>{"source": source, "uri": uri, "title": title}</code></li>
<li><code>MediaTrackField</code> fields have the Python structure <code>{"label": label, "kind": kind, "srclang": lang, "file_path": path}</code></li>
</ul>
<p>To add a support for a new field type, you will need to figure out the field type's JSON structure and convert that structure into the Python dictionary equivalent in the new field class methods. The best way to inspect a field type's JSON structure is to view the JSON representation of a node that contains instances of the field by tacking <code>?_format=json</code> to the end of the node's URL. Once you have an example of the field type's JSON, you will need to write the necessary class methods to convert between Workbench CSV data and the field's JSON structure as applicable in all of the field class methods, making sure you account for the field's configured cardinality, account for the update mode within the <code>update()</code> method, etc.</p>
<p>Writing field classes is one aspect of Workbench development that demonstrates the value of unit tests. Without writing unit tests to accompany the development of these field classes, you <em>will</em> lose your mind. <a href="https://github.com/mjordan/islandora_workbench/blob/main/tests/field_tests.py">tests/field_tests.py</a> contains over 80 tests in more than 5,000 lines of test code for a good reason.</p>
<h2 id="islandora-workbench-integration-drupal-module">Islandora Workbench Integration Drupal module</h2>
<p><a href="https://github.com/mjordan/islandora_workbench_integration">Islandora Workbench Integration</a> is a Drupal module that allows Islandora Workbench to communicate with Drupal efficiently and reliably. It enables some Views and REST endpoints that Workbench expects, and also provides a few custom REST endpoints (see the module's README for details).</p>
<p>Generally speaking, the only situation where the Integration module will need to be updated (apart from requirements imposed by new versions of Drupal) is if we add a new feature to Workbench that requires a specific View or a specific REST endpoint to be enabled and configured in the target Drupal. If a change is required in the Integration module, it is very important to communicate this to Workbench users, since if the Integration module is not updated to align with the change in Workbench, the new feature won't work.</p>
<p>A defensive coding strategy to ensure that changes in the client-side Workbench code that depend on changes in the server-side Integration module will work is, within the Workbench code, invoke the <code>check_integration_module_version()</code> function to check the Integration module's version number and use conditional logic to execute the new Workbench code only if the Integration module's version number meets or exceeds a version number string defined in that section of the Workbench code (e.g., the new Workbench feature requires version 1.1.3 of the Integration module). Under the hood, this function queries <code>/islandora_workbench_integration/version</code> on the target Drupal to get the Integration module's version number, although as a developer all you need to do is invoke the <code>check_integration_module_version()</code> function and inspect its return value. In this example, your code would compare the Integration module's version number with 1.1.3 (possibly using the <code>convert_semver_to_number()</code> utility function) and include logic so that it only executes if the minimum Integration module version is met.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some Views used by Islandora Workbench are defined by users and not by the Islandora Workbench Integration module. Specifically, Views described in the "<a href="https://mjordan.github.io/islandora_workbench_docs/generating_csv_files/">Generating CSV files</a>" documentation are created by users.</p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../troubleshooting/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Troubleshooting" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Troubleshooting
            </div>
          </div>
        </a>
      
      
        
        <a href="../changelog/" class="md-footer__link md-footer__link--next" aria-label="Next: Change log" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Change log
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>